(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{539:function(s,n,a){"use strict";a.r(n);var e=a(6),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_1-背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-背景"}},[s._v("#")]),s._v(" 1. 背景")]),s._v(" "),a("ul",[a("li",[s._v("项目需要实现一些敏感字段过滤")]),s._v(" "),a("li",[s._v("项目使用的为 jackson")]),s._v(" "),a("li",[s._v("过滤场景分两种\n"),a("ul",[a("li",[s._v("响应中的信息过滤")]),s._v(" "),a("li",[s._v("日志打印中的信息过滤 （配合日志切面记录过滤后的操作日志）")])])])]),s._v(" "),a("h1",{attrs:{id:"_2-响应过滤实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-响应过滤实现"}},[s._v("#")]),s._v(" 2. 响应过滤实现")]),s._v(" "),a("h2",{attrs:{id:"_2-1-自定义以下注解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-自定义以下注解"}},[s._v("#")]),s._v(" 2.1 自定义以下注解")]),s._v(" "),a("p",[s._v("JsonFieldFilters.java")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import java.lang.annotation.Documented;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.Target;\n\nimport static java.lang.annotation.ElementType.FIELD;\nimport static java.lang.annotation.ElementType.METHOD;\nimport static java.lang.annotation.RetentionPolicy.RUNTIME;\n\n/**\n * Json字段过滤器列表，用于组合多个字段过滤注解\n * @author liutao\n */\n@Documented\n@Retention(RUNTIME)\n@Target({ FIELD, METHOD })\npublic @interface JsonFieldFilters {\n\n    JsonFieldFilter[] value();\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("JsonFieldFilter.java")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import java.lang.annotation.*;\n\nimport static java.lang.annotation.ElementType.FIELD;\nimport static java.lang.annotation.RetentionPolicy.RUNTIME;\n\n/**\n * Json字段过滤器注解\n * @author liutao\n */\n@Documented\n@Retention(RUNTIME)\n@Target(value = { ElementType.METHOD,FIELD})\n@Repeatable(value= JsonFieldFilters.class)\npublic @interface JsonFieldFilter {\n\n    Class<?> value();\n\n    /**\n     * include为对象需要包含的字段，默认使用include，如果include为空，则使用exclude字段\n     *\n     * @return String[]\n     */\n    String[] include() default {};\n\n    /**\n     * exclude 要排除的字段\n     *\n     * @return String[]\n     */\n    String[] exclude() default {};\n\n\n    /**\n     * 目前只支持 RESPONSE\n     * @return\n     */\n    JacksonFilterType type() default  JacksonFilterType.RESPONSE;\n\n    enum JacksonFilterType {\n        REQUEST, RESPONSE;\n    }\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("p",[s._v("JsonFieldFilterBean.java")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import com.fasterxml.jackson.annotation.JsonFilter;\n\n/**\n * 系统默认使用include指定的字段，如果include为空，则使用exclude指定的字段\n * @author liutao\n */\npublic class JsonFieldFilterBean {\n\n\t/** 入参包含字段 */\n\tpublic static final String INCOME_PARAMETER_INCLUDE_FILTER = "income_include_filter";\n\n\t/** 入参排除字段  */\n\tpublic static final String INCOME_PARAMETER_EXCLUDE_FILTER = "income_exclude_filter";\n\n\t/** 出参包含字段 */\n\tpublic static final String OUTCOME_PARAMETER_INCLUDE_FILTER = "outcome_include_filter";\n\n\t/** 出参排除字段 */\n\tpublic static final String OUTCOME_PARAMETER_EXCLUDE_FILTER = "outcome_exclude_filter";\n\t\n\n\t@JsonFilter(INCOME_PARAMETER_INCLUDE_FILTER)\n\tpublic interface IncomeParameterIncludeFilter {\n\n\t}\n\n\t@JsonFilter(INCOME_PARAMETER_EXCLUDE_FILTER)\n\tpublic interface IncomeParameterExcludeFilter {\n\n\t}\n\n\t@JsonFilter(OUTCOME_PARAMETER_INCLUDE_FILTER)\n\tpublic interface OutcomeParameterIncludeFilter {\n\n\t}\n\n\t@JsonFilter(OUTCOME_PARAMETER_EXCLUDE_FILTER)\n\tpublic interface OutcomeParameterExcludeFilter {\n\n\t}\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("h2",{attrs:{id:"_2-2-拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-拦截器"}},[s._v("#")]),s._v(" 2.2 拦截器")]),s._v(" "),a("h3",{attrs:{id:"_2-2-1-注解拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-注解拦截器"}},[s._v("#")]),s._v(" 2.2.1 注解拦截器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import com.fasterxml.jackson.databind.ObjectMapper;\nimport kl.nbase.log.annotation.JsonFieldFilter;\nimport kl.nbase.log.annotation.JsonFieldFilters;\nimport kl.nbase.log.utils.JacksonFiltersUtil;\nimport org.apache.commons.lang3.reflect.FieldUtils;\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.Pointcut;\nimport org.aspectj.lang.reflect.MethodSignature;\nimport org.springframework.stereotype.Component;\n\nimport java.io.IOException;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Parameter;\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.stream.Collectors;\n\n/**\n * 使用Jackson实现的字段过滤器\n *\n * @author liutao\n */\n@Component\n@Aspect\npublic class JacksonFiltersComponent {\n\n    @Pointcut("@annotation(kl.nbase.log.annotation.JsonFieldFilters) "\n        + "|| @annotation(kl.nbase.log.annotation.JsonFieldFilter)")\n    public void jacksonFiltersPointCut() {\n    }\n\n    @Around(value = "jacksonFiltersPointCut()")\n    public Object jacksonFiltersAroundAdvice(ProceedingJoinPoint joinPoint) throws Throwable {\n        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();\n        Method method = methodSignature.getMethod();\n        Parameter[] parameters = method.getParameters();\n        // 获取注解\n        JsonFieldFilter jsonFieldFilterElem = method.getAnnotation(JsonFieldFilter.class);\n        JsonFieldFilter[] jsonFieldFilterArray = null;\n        JsonFieldFilters jsonFieldFilters;\n        if (jsonFieldFilterElem != null) {\n            jsonFieldFilterArray = new JsonFieldFilter[1];\n            jsonFieldFilterArray[0] = jsonFieldFilterElem;\n        } else if ((jsonFieldFilters = method.getAnnotation(JsonFieldFilters.class)) != null) {\n            jsonFieldFilterArray = jsonFieldFilters.value();\n        }\n\n        List<JsonFieldFilter> responseFilters;\n        if (jsonFieldFilterArray == null || jsonFieldFilterArray.length <= 0) {\n            return joinPoint.proceed();\n        }\n        // 解析出response请求注解\n        responseFilters = Arrays.stream(jsonFieldFilterArray)\n            .filter(jsonFieldFilter -> jsonFieldFilter.type() == JsonFieldFilter.JacksonFilterType.RESPONSE)\n            .collect(Collectors.toList());\n        // 方法执行\n        Object result = (parameters == null) ? joinPoint.proceed() : joinPoint.proceed(parameters);\n        // 处理response通知\n        return jacksonResponseFilterHandler(joinPoint, responseFilters, result);\n    }\n\n\n    /**\n     * 过滤响应信息\n     *\n     * @param joinPoint\n     * @param responseFilters\n     * @param result\n     * @return\n     * @throws IOException\n     */\n    private Object jacksonResponseFilterHandler(ProceedingJoinPoint joinPoint, List<JsonFieldFilter> responseFilters,\n                                                Object result) throws IOException {\n\n        List<JacksonFilterParam> filterParamList = new ArrayList<>();\n        for (JsonFieldFilter jsonFieldFilter : responseFilters) {\n            final Class<?> clazz = jsonFieldFilter.value();\n            JsonFieldFilter.JacksonFilterType type = jsonFieldFilter.type();\n\n            if (!type.equals(JsonFieldFilter.JacksonFilterType.RESPONSE)) {\n                return result;\n            }\n            // 判断要include filter和exclude filter过滤\n            // 获取注解参数,不包含父类参数(对于集成暂时不考虑)\n            Field[] fields = FieldUtils.getAllFields(clazz);\n            final String[] includeFields = jsonFieldFilter.include();\n            final String[] excludeFields = jsonFieldFilter.exclude();\n\n            // 获取可以进行过滤的属性，优先使用include中屬性，如果include为空，使用exclude屬性,(如果都不为空使用include)\n            Set<String> includeFilterFields = getFilterFields(fields, includeFields);\n            Set<String> excludeFilterFields = getFilterFields(fields, excludeFields);\n            if (includeFilterFields == null && excludeFilterFields == null) {\n                continue;\n            }\n\n            JacksonFilterParam filterParam;\n            if (includeFilterFields != null) {\n                filterParam = JacksonFilterParam.buildIncludeFilterParam(clazz, includeFilterFields);\n            } else {\n                filterParam = JacksonFilterParam.buildExcludeFilterParam(clazz, excludeFilterFields);\n            }\n            filterParamList.add(filterParam);\n        }\n\n        ObjectMapper objectMapper = JacksonFiltersUtil.getMixObjectMapper(filterParamList);\n        String argsJson = objectMapper.writeValueAsString(result);\n        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();\n        return objectMapper.readValue(argsJson, methodSignature.getReturnType());\n    }\n\n    private Set<String> getFilterFields(Field[] fields, final String[] toBeFilterFields) {\n        if (fields == null || fields.length <= 0 || toBeFilterFields == null || toBeFilterFields.length <= 0) {\n            return null;\n        }\n        return Arrays.stream(fields)\n            .filter(filed -> Arrays.asList(toBeFilterFields).contains(filed.getName()))\n            .map(Field::getName).collect(Collectors.toSet());\n\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br")])]),a("h3",{attrs:{id:"_2-2-2-用于组装jackson过滤器的参数类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-用于组装jackson过滤器的参数类"}},[s._v("#")]),s._v(" 2.2.2 用于组装jackson过滤器的参数类")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import kl.nbase.log.annotation.JsonFieldFilterBean;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.Set;\n\n/**\n * 用于组装jackson过滤器的参数类\n *\n * @author liutao\n */\npublic class JacksonFilterParam {\n    /**\n     * 目标类类型\n     */\n    private Class<?> toBeMixVo;\n    /**\n     * 过滤器类型\n     *\n     * @see JsonFieldFilterBean\n     */\n    private Class<?> toBeMixFilter;\n    /**\n     * 待过滤的字段名\n     */\n    private Set<String> toBeFilterFields;\n    /**\n     * 过滤器id\n     *\n     * @see JsonFieldFilterBean\n     */\n    private String filterId;\n    /**\n     * 是否为include模式\n     */\n    private boolean isInclude;\n\n    public static JacksonFilterParam buildExcludeFilterParam(Class<?> clazz, String[] excludeFields) {\n        Set<String> excludeFieldsSet = new HashSet<>();\n        Collections.addAll(excludeFieldsSet, excludeFields);\n        return buildExcludeFilterParam(clazz, excludeFieldsSet);\n    }\n    public static JacksonFilterParam buildExcludeFilterParam(Class<?> clazz, Set<String> excludeFields) {\n        JacksonFilterParam filterParam = new JacksonFilterParam();\n        filterParam.setInclude(false);\n        filterParam.setFilterId(JsonFieldFilterBean.OUTCOME_PARAMETER_EXCLUDE_FILTER);\n        filterParam.setToBeFilterFields(excludeFields);\n        filterParam.setToBeMixFilter(JsonFieldFilterBean.OutcomeParameterExcludeFilter.class);\n        filterParam.setToBeMixVo(clazz);\n\n        return filterParam;\n    }\n\n    public static JacksonFilterParam buildIncludeFilterParam(Class<?> clazz, String[] includeFields) {\n        Set<String> includeFieldsSet = new HashSet<>();\n        Collections.addAll(includeFieldsSet, includeFields);\n        return buildIncludeFilterParam(clazz, includeFieldsSet);\n    }\n    public static JacksonFilterParam buildIncludeFilterParam(Class<?> clazz, Set<String> includeFields) {\n        JacksonFilterParam filterParam = new JacksonFilterParam();\n        filterParam.setInclude(true);\n        filterParam.setFilterId(JsonFieldFilterBean.OUTCOME_PARAMETER_INCLUDE_FILTER);\n        filterParam.setToBeFilterFields(includeFields);\n        filterParam.setToBeMixFilter(JsonFieldFilterBean.OutcomeParameterIncludeFilter.class);\n        filterParam.setToBeMixVo(clazz);\n\n        return filterParam;\n    }\n\n\n    public Class<?> getToBeMixVo() {\n        return toBeMixVo;\n    }\n\n    public JacksonFilterParam setToBeMixVo(Class<?> toBeMixVo) {\n        this.toBeMixVo = toBeMixVo;\n        return this;\n    }\n\n    public Class<?> getToBeMixFilter() {\n        return toBeMixFilter;\n    }\n\n    public JacksonFilterParam setToBeMixFilter(Class<?> toBeMixFilter) {\n        this.toBeMixFilter = toBeMixFilter;\n        return this;\n    }\n\n    public Set<String> getToBeFilterFields() {\n        return toBeFilterFields;\n    }\n\n    public JacksonFilterParam setToBeFilterFields(Set<String> toBeFilterFields) {\n        this.toBeFilterFields = toBeFilterFields;\n        return this;\n    }\n\n    public String getFilterId() {\n        return filterId;\n    }\n\n    public JacksonFilterParam setFilterId(String filterId) {\n        this.filterId = filterId;\n        return this;\n    }\n\n    public boolean isInclude() {\n        return isInclude;\n    }\n\n    public JacksonFilterParam setInclude(boolean include) {\n        isInclude = include;\n        return this;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br")])]),a("h3",{attrs:{id:"_2-2-3-工具类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-工具类"}},[s._v("#")]),s._v(" 2.2.3 工具类")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("package kl.nbase.log.utils;\n\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;\nimport com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;\nimport kl.nbase.log.exception.LogInternalError;\nimport kl.nbase.log.filter.JacksonFilterParam;\n\nimport java.util.*;\n\n/**\n * 基于jacson实现的字段过滤工具类\n * @author liutao\n */\npublic class JacksonFiltersUtil {\n\n    private JacksonFiltersUtil(){}\n\n    /**\n     * 过滤类中的指定字段,并返回json字符串\n     * @param tobeFilterObject 待过滤的类\n     * @param filterStr 指定的屏蔽字段\n     * @return\n     */\n    public static String transJsonFilter(Object tobeFilterObject, String[] filterStr) {\n        JacksonFilterParam filterParam = JacksonFilterParam.buildExcludeFilterParam(tobeFilterObject.getClass(), filterStr);\n        return transJsonFilter(tobeFilterObject, Collections.singletonList(filterParam));\n    }\n    \n    \n    /**\n     * 过滤json中的指定字段,并返回过滤后的json字符串，支持嵌套过滤\n     \n     * @return\n     */\n    public static String jsonFilter(String json, String[] filterStr) {\n        ObjectMapper objectMapper = new ObjectMapper();\n        Object jsonObject = null;\n        try {\n            jsonObject = objectMapper.readValue(json, Object.class);\n        } catch (JsonProcessingException e) {\n            throw LogInternalError.JSON_PROCESS_FAILED.toException(e);\n        }\n        return JacksonFiltersUtil.transJsonFilter(jsonObject, filterStr);\n    }\n\n    /**\n     * 复杂的json字段过滤方式\n     * @param tobeFilterObject 待过滤的类\n     * @param filterParamList 过滤所需的自定义参数\n     * @return\n     */\n    public static String transJsonFilter(Object tobeFilterObject, List<JacksonFilterParam> filterParamList) {\n        ObjectMapper objectMapper = getMixObjectMapper(filterParamList);\n        try {\n            return objectMapper.writeValueAsString(tobeFilterObject);\n        } catch (JsonProcessingException e) {\n            throw LogInternalError.JSON_PROCESS_FAILED.toException(e);\n        }\n    }\n\n    /**\n     * 获取带过滤器的ObjectMapper\n     * @param filterParamList\n     * @return\n     */\n    public static ObjectMapper getMixObjectMapper(List<JacksonFilterParam> filterParamList) {\n        ObjectMapper objectMapper = new ObjectMapper();\n        SimpleFilterProvider simpleFilterProvider = new SimpleFilterProvider();\n\n        // 两个过滤字段集合，对应include和exclude两种模式\n        Set<String> includeToBeFilterFields = new HashSet<>();\n        Set<String> excludeToBeFilterFields = new HashSet<>();\n        for (JacksonFilterParam filterParam : filterParamList) {\n            if (filterParam.isInclude()) {\n                includeToBeFilterFields.addAll(filterParam.getToBeFilterFields());\n                simpleFilterProvider.addFilter(filterParam.getFilterId(), SimpleBeanPropertyFilter.filterOutAllExcept(includeToBeFilterFields));\n            } else {\n                excludeToBeFilterFields.addAll(filterParam.getToBeFilterFields());\n                simpleFilterProvider.addFilter(filterParam.getFilterId(), SimpleBeanPropertyFilter.serializeAllExcept(excludeToBeFilterFields));\n            }\n\n            // 由于目标类上没有JsonFilter注解，用于指定过滤器id，故使用混合方式\n            objectMapper.addMixIn(filterParam.getToBeMixVo(), filterParam.getToBeMixFilter());\n\n        }\n        objectMapper.setFilterProvider(simpleFilterProvider);\n        return objectMapper;\n    }\n\n    /**\n     * 判断是否是json格式\n     * @param json\n     * @return\n     */\n    public static boolean isJsonStr(String json) {\n        ObjectMapper objectMapper = new ObjectMapper();\n        try {\n            objectMapper.readTree(json);\n            return true;\n        } catch (JsonProcessingException e) {\n            return false;\n        }\n    }\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br")])]),a("h2",{attrs:{id:"_2-3-使用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-使用方式"}},[s._v("#")]),s._v(" 2.3 使用方式")]),s._v(" "),a("h3",{attrs:{id:"方式1-注解方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式1-注解方式"}},[s._v("#")]),s._v(" 方式1: 注解方式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RestController\n@RequestMapping("/dbConfig")\n@Tag(name = "数据库配置")\n@LogCollector(resolver = OperationLogResolver.class)\npublic class DbConfigController {\n\n    @Resource\n    DbConfigService dbConfigService;\n    @Resource\n    private ValidateHelper validateUtil;\n\n    @GetMapping("/info")\n    @Operation(summary = "查询数据库配置")\n    @JsonFieldFilters(value = {\n        @JsonFieldFilter(exclude = {"password"}, value = DbConfigInfo.class, type = JsonFieldFilter.JacksonFilterType.RESPONSE)\n    })\n    public RestResponse<DbConfigResponse> queryDbConfig() {\n        SlotDataSourceConfig slotDataSourceConfig = dbConfigService.queryDbConfig();\n\n        if (Objects.isNull(slotDataSourceConfig)) {\n            return RestResponse.success(null);\n        }\n\n        return RestResponse.success(DbPropertiesHelper.translate2DbConfigResponse(slotDataSourceConfig));\n    }\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("h3",{attrs:{id:"方式2-工具类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式2-工具类"}},[s._v("#")]),s._v(" 方式2: 工具类")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('package kl.nbase.log.utils;\n\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport org.junit.jupiter.api.Assertions;\nimport org.junit.jupiter.api.Test;\n\npublic class JacksonFiltersUtilTest {\n\n    @Test\n    void testJacksonFilters() throws JsonProcessingException {\n        User user = new User("小明", "123456", "xiaoming@test.com", "15014568962");\n\n        String result = JacksonFiltersUtil.transJsonFilter(user, new String[]{"password","phone"});\n        Assertions.assertEquals("{\\"userName\\":\\"小明\\",\\"email\\":\\"xiaoming@test.com\\"}", result);\n    }\n\n    static class User{\n        private String userName;\n        private String password;\n        private String email;\n        private String phone;\n\n        public User(String userName, String password, String email, String phone) {\n            this.userName = userName;\n            this.password = password;\n            this.email = email;\n            this.phone = phone;\n        }\n\n        public String getUserName() {\n            return userName;\n        }\n\n        public User setUserName(String userName) {\n            this.userName = userName;\n            return this;\n        }\n\n        public String getPassword() {\n            return password;\n        }\n\n        public User setPassword(String password) {\n            this.password = password;\n            return this;\n        }\n\n        public String getEmail() {\n            return email;\n        }\n\n        public User setEmail(String email) {\n            this.email = email;\n            return this;\n        }\n\n        public String getPhone() {\n            return phone;\n        }\n\n        public User setPhone(String phone) {\n            this.phone = phone;\n            return this;\n        }\n    }\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br")])]),a("h3",{attrs:{id:"关于嵌套过滤的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于嵌套过滤的使用"}},[s._v("#")]),s._v(" 关于嵌套过滤的使用")]),s._v(" "),a("h4",{attrs:{id:"_1-类过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-类过滤"}},[s._v("#")]),s._v(" 1. 类过滤")]),s._v(" "),a("p",[s._v("如果存在以下的类关系,想过滤 City中的state信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("public class User {\n    private String name;\n    private City city;\n}\n\npublic class City {\n    private String name;\n    private String state;\n    private String street;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("解决方案如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('JacksonFilterParam filterParam = JacksonFilterParam.buildExcludeFilterParam(City.class, new String[]{"state"});\n\nUser user = new User("job", new City("上海", "2","a街道"));\n\nString result = JacksonFiltersUtil.transJsonFilter(liutao, Collections.singletonList(filterParam));\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("如果想过滤 所有类中的name字段，解决方案如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('JacksonFilterParam filterParam = JacksonFilterParam.buildExcludeFilterParam(Object.class, new String[]{"name"});\n\nUser user = new User("job", new City("上海", "2","a街道"));\n\nString result = JacksonFiltersUtil.transJsonFilter(liutao, Collections.singletonList(filterParam));\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_2-json字符串过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-json字符串过滤"}},[s._v("#")]),s._v(" 2. json字符串过滤")]),s._v(" "),a("ul",[a("li",[s._v("如果想过滤json字符串中的字段，有以下方案")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    public static void main(String[] args) throws JsonProcessingException {\n        String json = "{\\n" +\n            "  \\"user\\": {\\n" +\n            "    \\"id\\": 123,\\n" +\n            "    \\"name\\": \\"John Doe\\",\\n" +\n            "    \\"email\\": \\"john.doe@example.com\\",\\n" +\n            "    \\"address\\": {\\n" +\n            "      \\"street\\": \\"123 Main St\\",\\n" +\n            "      \\"city\\": \\"Anytown\\",\\n" +\n            "      \\"state\\": \\"CA\\",\\n" +\n            "      \\"postal_code\\": \\"12345\\"\\n" +\n            "    },\\n" +\n            "    \\"phone_numbers\\": [\\n" +\n            "      \\"123-456-7890\\",\\n" +\n            "      \\"098-765-4321\\"\\n" +\n            "    ]\\n" +\n            "  }\\n" +\n            "}";\n\n        ObjectMapper objectMapper = new ObjectMapper();\n        Object o = objectMapper.readValue(json, Object.class);\n        String result = JacksonFiltersUtil.transJsonFilter(o, new String[]{"city"});\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("ul",[a("li",[s._v('这种过滤方案 会过滤所有的 名为"city"的字段')])]),s._v(" "),a("h1",{attrs:{id:"_3-扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-扩展"}},[s._v("#")]),s._v(" 3. 扩展")]),s._v(" "),a("ul",[a("li",[s._v("调用objectMapper.readValue时，如果不确定json的类格式，那么可以指定为Object.class")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Object o = objectMapper.readValue(json, Object.class);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("这样解析后的对象实际为 LinkedHashMap。")])])])}),[],!1,null,null,null);n.default=t.exports}}]);