(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{528:function(s,a,t){"use strict";t.r(a);var e=t(6),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"问题现象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题现象"}},[s._v("#")]),s._v(" 问题现象")]),s._v(" "),t("ul",[t("li",[s._v("使用ssh登录公司linux服务器时， 发现耗时非常较久")])]),s._v(" "),t("h2",{attrs:{id:"排查过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排查过程"}},[s._v("#")]),s._v(" 排查过程")]),s._v(" "),t("ul",[t("li",[s._v("1.展示登录详情，用来确定具体卡在哪一块")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ssh -v root@xx.xx.xx.xx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("2.我这边是卡在debug1: pledge: network")])]),s._v(" "),t("h2",{attrs:{id:"原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[s._v("#")]),s._v(" 原因")]),s._v(" "),t("p",[s._v("卡在debug1: pledge: network一般会有以下几方面的原因:")]),s._v(" "),t("h3",{attrs:{id:"var-log-btmp文件过大"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#var-log-btmp文件过大"}},[s._v("#")]),s._v(" /var/log/btmp文件过大")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('此问题是由大btmp文件（数百MB）引起的。该文件记录登录尝试。\n当人们试图强行使用您的密码时，此文件可能很大并且会导致"pledge: network"阶段延迟。\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"d-bus-and-systemd-进程导致的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#d-bus-and-systemd-进程导致的问题"}},[s._v("#")]),s._v(" D-Bus and systemd 进程导致的问题")]),s._v(" "),t("ul",[t("li",[s._v("检查/var/log/auth.log日志文件，确认是否有如下的报错：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sshd[2721]: pam_systemd(sshd:session): Failed to create session: Connection timed out\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("如果有，请重启systemd-logind服务：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart systemd-logind\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"rsyslogd服务奔溃"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rsyslogd服务奔溃"}},[s._v("#")]),s._v(" rsyslogd服务奔溃")]),s._v(" "),t("ul",[t("li",[s._v("如果发现在/ var / log / syslog或/var/log/mail.log中不再有日志消息，则可能是rsyslog进程奔溃了，此时我们只需要重启该服务即可")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart  rsyslog\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"检查如下日志文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查如下日志文件"}},[s._v("#")]),s._v(" 检查如下日志文件")]),s._v(" "),t("p",[s._v("/var/log/wtmp\n/var/log/utmp")]),s._v(" "),t("p",[s._v("如果过大，则清掉。")]),s._v(" "),t("h3",{attrs:{id:"无异常"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#无异常"}},[s._v("#")]),s._v(" 无异常")]),s._v(" "),t("p",[s._v("如果在主机其他方面没有什么异常的情况下，突然从某天开始ssh登陆就很慢，最简单的办法，上来先看日志：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /var/log/\n\nls -l\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("就看哪个日志文件很大，一般上G了基本就有问题，备份后清理掉在试基本能解决问题。")])])}),[],!1,null,null,null);a.default=r.exports}}]);