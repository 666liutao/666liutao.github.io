(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{525:function(n,s,a){"use strict";a.r(s);var t=a(6),e=Object(t.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"_1-事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-事务"}},[n._v("#")]),n._v(" 1. 事务")]),n._v(" "),a("p",[n._v("在关系型数据库中，有一个很重要的概念，叫做事务（Transaction）。它具有 ACID 四个特性：")]),n._v(" "),a("ul",[a("li",[n._v("A（Atomicity）：原子性，一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。")]),n._v(" "),a("li",[n._v("C（Consistency）：一致性，事务必须是使数据库从一个一致性状态变到另一个一致性状态。")]),n._v(" "),a("li",[n._v("I（Isolation）：隔离性，一个事务的执行不能被其他事务干扰。")]),n._v(" "),a("li",[n._v("D（Durability）：持久性，，指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。")])]),n._v(" "),a("h2",{attrs:{id:"_2-jdbc的事务支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-jdbc的事务支持"}},[n._v("#")]),n._v(" 2. JDBC的事务支持")]),n._v(" "),a("ul",[a("li",[n._v("JDBC 是使用 Connection 来控制事务的。")]),n._v(" "),a("li",[n._v("Connection 默认使用自动提交策略，即关闭事务，这种情况下，每一条 SQL 语句一旦执行，就会立即提交到数据库，无法回滚。")]),n._v(" "),a("li",[n._v("Connection 提供了以下三个事务相关的接口：")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// 关闭自动提交，开启事务\nvoid setAutoCommit(boolean autoCommit) throws SQLException;\n \n// 提交事务\nvoid commit() throws SQLException;\n \n// 回滚事务\nvoid rollback() throws SQLException;\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])]),a("ul",[a("li",[n._v("setAutoCommit(boolean autoCommit) 方法其实做了两件事情：\n"),a("ul",[a("li",[n._v("更改提交策略")]),n._v(" "),a("li",[n._v("开启事务")])])]),n._v(" "),a("li",[n._v("commit() 方法负责将一个事务内部的所有 SQL 语句一次性提交（全部执行，或者全部不执行）。")]),n._v(" "),a("li",[n._v("rollback() 方法负责回滚事务。")]),n._v(" "),a("li",[n._v("对于 rollback，有一点需要特别注意，如果系统遇到一个未处理的 SQLException，程序会自动回滚；反之，如果这个异常被捕获，则需要手动回滚。")])]),n._v(" "),a("h2",{attrs:{id:"_3-savepoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-savepoint"}},[n._v("#")]),n._v(" 3. Savepoint")]),n._v(" "),a("ul",[a("li",[n._v("JDBC 另外提供了一个 Savepoint 接口，用来实现事务部分提交。")]),n._v(" "),a("li",[n._v("有时候，我们并不希望一个事务全部执行，或者全部不执行，可能会有这样的需求：")]),n._v(" "),a("li",[n._v("如果执行到某一步出错，回滚的时候返回之前开启事务之后的某一个点。")]),n._v(" "),a("li",[n._v("这时候就需要 Savepoint（这个和 Hiberbate 的隔离级别很类似）。")]),n._v(" "),a("li",[n._v("通过以下示例代码，在执行 sql3 的时候出错，但是由于在执行完 sql1 的时候使用了 Savepoint，所以第一条 SQL 语句的执行结果会保留到数据库中：")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("package com.liutao.demo;\n \nimport com.liutao.util.Connector;\nimport com.liutao.util.DriverLoader;\n \nimport java.sql.Connection;\nimport java.sql.SQLException;\nimport java.sql.Savepoint;\nimport java.sql.Statement;\n \npublic final class SavePointDemo {\n \n    public static void main(String[] args) {\n        String sql1 = \"INSERT INTO STUDENT (STUDENT_NAME, STUDENT_PASSWORD) VALUES ('Ramsey', '999999')\";\n        String sql2 = \"INSERT INTO STUDENT (STUDENT_NAME, STUDENT_PASSWORD) VALUES ('Wilshere', '888888')\";\n        // Invalidate SQL\n        String sql3 = \"INSERT INTO STUDENT VALUES(1, 'Ramsey', '999999')\";\n \n        DriverLoader.loadSqliteDriver();\n        try (Connection conn = Connector.getSqlConnection()) {\n            conn.setAutoCommit(false);\n            Savepoint save1 = null;\n            try (Statement stmt = conn.createStatement()) {\n                stmt.executeUpdate(sql1);\n                save1 = conn.setSavepoint();\n                stmt.executeUpdate(sql2);\n                stmt.executeUpdate(sql3);\n            } catch (SQLException e) {\n                conn.rollback(save1);\n            }\n            conn.commit();\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);