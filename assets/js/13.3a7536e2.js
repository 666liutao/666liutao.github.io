(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{518:function(n,s,e){"use strict";e.r(s);var a=e(6),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h2",{attrs:{id:"_1-问题代码如下："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题代码如下："}},[n._v("#")]),n._v(" 1. 问题代码如下：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public static void main(String[] args) {\n        new NettyClient2().connect("127.0.0.1", 39991);\n    }\n\n    private void connect(String ip, int port) {\n        // 配置客户端Nio线程组\n        NioEventLoopGroup clientGroup = new NioEventLoopGroup();\n        Bootstrap b = new Bootstrap();\n        b.group(clientGroup).channel(NioSocketChannel.class)\n            .option(ChannelOption.TCP_NODELAY, true)\n            .handler(new ChannelInitializer<SocketChannel>() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline()\n                        .addLast(new Asn1DerMsgDecoder())\n                        .addLast(new SimpleChannelInboundHandler<byte[]> (){\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) {\n                           // 发送数据\n                            System.out.println("发送数据:"+ new String(msg));\n                            ctx.writeAndFlush(msg);\n                        }\n                        @Override\n                        public void channelRead0(ChannelHandlerContext ctx, byte[] msg) {\n//                            ByteBuf byteBuf = (ByteBuf) msg;\n//                            byte[] response = new byte[byteBuf.readableBytes()];\n                            System.out.println("收到的响应:"+Base64.encodeBase64String(msg));\n                            // 关闭链路\n                            ctx.close();\n                        }\n\n                        });\n                }\n            });\n\n        try {\n            // 发起异步连接操作，调用同步方法等待连接成功\n            ChannelFuture f = b.connect(ip, port).sync();\n            // 等待客户端链路关闭\n            f.channel().closeFuture().sync();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }finally {\n            clientGroup.shutdownGracefully();\n        }\n\n    }\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br")])]),e("h2",{attrs:{id:"_2-问题解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题解决"}},[n._v("#")]),n._v(" 2. 问题解决")]),n._v(" "),e("ul",[e("li",[n._v("因为netty默认是将byte数组解码编码成ByteBuf")]),n._v(" "),e("li",[n._v("由于上述代码并未自定义编解码器，且传输的数据类型是 String，故导致数据无法发送")]),n._v(" "),e("li",[n._v("如果想传输不同类型的数据,需要在netty启动类里添加编码器。 或者用下面的方式：")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@Override\npublic void channelActive(ChannelHandlerContext ctx) {\n    byte[] req = "1".getBytes();\n    ByteBuf buffer = Unpooled.buffer(req.length);\n    buffer.writeBytes(req);\n    // 发送数据\n    ctx.writeAndFlush(buffer);\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);