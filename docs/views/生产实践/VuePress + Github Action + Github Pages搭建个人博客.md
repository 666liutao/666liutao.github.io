---
title: VuePress + Github Action + Github Pages搭建个人博客
date: 2024-04-24
tags:
 - CICD
 - 博客搭建
categories:
 - 生产实践
sidebar: 'auto'
---

::: tip
* vuepress 简洁易用
* Github Pages配合github好管理
* GithubAction 自动发布
:::

# 1. 背景
- 由于之前使用的自动构建发布工具travis开始收费了，所以打算使用Github Action替代

# 2. 工具说明
- VuePress: 是一款Vue驱动的静态网站生成器,可以方便的快速搭建自己的静态博客
- Github Pages: 是一个免费的静态网站托管服务，由 GitHub 提供。特点是 方便快捷，无需备案，免费域名，也可支持自定义域名。
- Github Action: github的持续集成服务，使用说明: [官方文档](https://docs.github.com/zh/actions)

# 3. 搭建过程

## 3.1 创建 GitHub Pages 站点
- 创建项目仓库，仓库命名无限制，本博客的仓库名称与访问地址一致，为 liutao1006.github.io
- 创建两个分支
  - master : 默认分支，用于保存编译构建后的静态页面，无需手动管理
  - doc :  文档分支，用于保存博客文档，以及vuepress的配置。
- 将仓库设置为站点,方式如下图： [也可参考官方文档](https://docs.github.com/zh/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site)
  - ![img](https://raw.githubusercontent.com/liutao1996/images/main/note/CICD/github%E9%85%8D%E7%BD%AE%E7%AB%99%E7%82%B9%E9%A1%B5%E9%9D%A2.jpg)

## 3.2 vuepress工程

- 关于vuepress的配置不做描述，[请参考官方文档](https://vuepress.vuejs.org/zh/guide/page.html)
- 如若进行配置过于繁琐，可使用本博客的模板，[工程代码位置](https://github.com/liutao1996/liutao1996.github.io/releases/tag/vuepress-blog)
- 下载后，进行个人定制化配置，如站点名称，图标等，然后将该工程代码，推送至 doc 分支

## 3.3 Github Action配置

### deploy.yml
- GitHub Actions 的配置文件叫做 workflow 文件，存放在代码仓库的.github/workflows目录，后缀统一为 yml
- 在doc分支下，创建 .github/workflows/deploy.yml
- [配置文件样例](https://github.com/liutao1996/liutao1996.github.io/blob/doc/.github/workflows/deploy.yml)

### token配置
- deploy.yml中存在一个  secrets.ACCESS_TOKEN 变量，该变量是仓库访问的token，用于工作流向仓库推送代码，
- 创建token具体操作如下:
  - 点击头像 ---> Setting ---> Developer settings ---> Personal access tokens ---> Generate new token(classic)
  - 创建的token名字要和deploy.yml中的变量保持一致，这里为ACCESS_TOKEN，有效期建议为永久(No expiration)
  - 权限勾选 repo 以及 workflows 即可


# 4. 实际使用

- 本地IDEA拉取仓库代码，分支切换至 doc
- 在 docs/views 目录 创建自己的第一篇博客文章(markdown格式)
- 最后提交，推送至远程仓库，等待工作流构建完毕
- 访问 liutao1996.github.io 即可

# 5.问题

## 5.1 如果出现构建失败
- 查看构建失败的日志，位置：Actions, 点击最新的构建失败的工作流，点击Jobs-build, 即可查看构建过程中的日志
- 举例，本博客在构建出现以下问题：
```
yarn install v1.22.22
warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
[1/4] Resolving packages...
[2/4] Fetching packages...
error Error: certificate has expired
    at TLSSocket.onConnectSecure (_tls_wrap.js:1515:34)
    at TLSSocket.emit (events.js:400:28)
    at TLSSocket._finishInit (_tls_wrap.js:937:8)
    at TLSWrap.ssl.onhandshakedone (_tls_wrap.js:709:12)
info Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.
Error: Process completed with exit code 1.
```
- 该问题的原因是证书过期导致 https访问失败，那么对应的解决方案是忽略tls证书验证即可
- 具体操作:deploy.yml增加以下构建步骤即可
```
      # 避免出现HTTPS 证书验证失败
      - name:
        run: yarn config set "strict-ssl" false -g
```

## 5.2 依赖问题

- 如果package.json中依赖发生变化,需要将deploy.yml中使用缓存依赖的步骤去除，待执行一次后，再重新加上
- 去除的步骤如下
```
      # 缓存 node_modules,如果package.json中依赖发生变化，建议将此步骤先移除，否则构建时不会刷新依赖
      - name: Cache dependencies
        uses: actions/cache@v2
        id: yarn-cache
        with:
          path: |
            **/node_modules
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          restore-keys: |
            ${{ runner.os }}-yarn-
```

# 6. 扩展

## 6.1 增加评论功能

### 方法1: 使用vssue

- 在package.json中引入插件依赖
```
"@vssue/api-github-v4": "^1.4.7",
"@vssue/vuepress-plugin-vssue": "^1.4.8",
```
- 在.vuepress/config.js中进行插件配置
```
module.exports = {
    plugins: [
        [
            '@vssue/vuepress-plugin-vssue',
            {
                // 设置 `platform` 而不是 `api`
                platform: 'github-v4',// v3的platform是github，v4的是github-v4
                // 其他的 Vssue 配置
                owner: 'liutao1996',    // 仓库的拥有者名称
                repo: 'liutao1996.github.io', // 存储评论的仓库名称
                clientId: 'Ov23liG11NcHSiAZOq5R', // 刚保存下来的 Client ID
                clientSecret: 'xxxxxxxxxxxxxxxxxxxxx', // 刚才保存下来的 Client secrets
                autoCreateIssue: true // 自动创建 Issue
            }
        ],
   ]
}
```
- clientId及clientSecret的生成：
  - 点击头像 ---> Setting ---> Developer settings ---> OAuth Apps ---> New OAuth App 
  - Homepage URL填写博客首页地址: https://liutao1996.github.io/
  - Authorization callback URL填写博客首页地址: https://liutao1996.github.io/
  - 提交
- 使用: 在需要开启评论的markdown文章末尾，加一行
  ```
   <Vssue/>
  ```
#### 该方法遇到的问题
- https://github.com/meteorlxy/vssue/issues/131
- 速率限制: https://docs.github.com/zh/graphql/overview/rate-limits-and-node-limits-for-the-graphql-api?apiVersion=2022-11-28
- 目前使用过程中发现，在请求https://api.github.com/graphql时，出现403，原因是请求体中的X-Ratelimit-Limit=0，估计是vssue的问题                                                     

### 方法2: 使用gitalk
- https://cloud.tencent.com/developer/article/1533079

## 6.2 seo的解决
- https://zhuanlan.zhihu.com/p/678324158

参考文章:
https://zhuanlan.zhihu.com/p/58229299
https://zhuanlan.zhihu.com/p/393344955
https://zhuanlan.zhihu.com/p/647963756
https://zhuanlan.zhihu.com/p/93030651
https://blog.csdn.net/qq_43173415/article/details/117741139

<Vssue/>